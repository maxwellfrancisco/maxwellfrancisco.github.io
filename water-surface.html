<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Maxwell Francisco - Water Body Surface Area over Time with Python</title>

  <style>
    body {
      font-family: Trebuchet MS, sans-serif;
      max-width: 900px;
      margin: 40px auto;
      line-height: 1.6;
    }

    nav a {
      margin-right: 15px;
      text-decoration: none;
      font-weight: bold;
    }

    h1 {
      margin-bottom: 5px;
    }

    a:link,
    a:visited {
      color: #1a1a1a;
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
      color: #444;
    }

    .map-embed {
      width: 100%;
      height: 500px;
      border: 1px solid #ddd;
      margin: 20px 0;
    }

    ul {
      margin-top: 5px;
    }
  </style>
</head>

<body>

<nav>
  <a href="index.html">Home</a>
  <a href="resume.html" target="_blank">Resume</a>
  <a href="https://www.linkedin.com/in/maxwell-francisco/" target="_blank">LinkedIn</a>  
</nav>

<h1>Water Body Surface Area over Time with Python</h1>
<p><strong>Tools:</strong> ArcPy, Pandas, Raster Algebra.</p>

  

<h2>Overview</h2>
<p>
This project uses ArcPy to determine the surface area of a water body using the Normalized Water Difference Index (NDWI). The user inputs the
Landsat images, water body study area shapefile, and the name of the water body. The script outputs rasters containing the water pixels for each 
given year which can be used for visualization and a graph showing change in water surface area over time.
  
</p>


<h2>Data</h2>
<ul>
  <li>Landsat Images</li>
  <li>Texas Water Development Board Water Body Shapefiles</li>
</ul>



<h2>GIS Methods</h2>
<ul>
<li>Raster Algebra - Normalized Water Difference Index</li>
  <li>Clipping</li>
  <li>Reclassification</li>
  <li>Raster attribute table parsing</li>
</ul>

<p>
Maps
</p>
  
<img
  src="images/huanuco_poster_map.png" 
  alt="poster"
  width="900">

<!-- MAP EMBED GOES HERE -->
<p>
ArcGIS Online Viewer
</p>
<iframe
  class="map-embed"
  src="https://www.arcgis.com/apps/mapviewer/index.html?configurableview=true&webmap=45cdcad30cc74c98b24be5097928a715&theme=light&heading=true&legend=true&scroll=false&center=-76.81617448421562,-9.873085988907114&scale=2256.994353"
  loading="eager">
</iframe>

<h2>Code</h2>
<pre>
  <code>
    ### Helping Dictionaries, Lists, Sets ###

# Dictionary for the determineSatellite function to work
BandMap = {
    'LC08': {'NIR': 'B5', 'Green': 'B3'},
    'LC09': {'NIR': 'B5', 'Green': 'B3'},
    'LE07': {'NIR': 'B4', 'Green': 'B2'},
    'LT05': {'NIR': 'B4', 'Green': 'B2'}}

# Necessary 2D list argument for the ArcPy Reclassify method
remap = RemapRange([
    [-100000, 0, "NODATA"],   # < 0 becomes NoData
    [0.0000001, 100000, 1]])  # > 0 becomes 1

### Helping Functions ###
def createFolders(proj_path, water_body):
    path = proj_path + "\\" + water_body.replace(" ", "_")
    os.makedirs(path, exist_ok=True)
    print(f"{path} created or already existed.")
    landsats = path+r"\Landsats"
    os.makedirs(landsats, exist_ok=True) # Folder must contain subfolders that are named with their respective year for organization/graph
    print(f"{landsats} created or already existed.")
    study_area = path+r"\Study_area" #Folder to contain all the shapefiles which needed to be added by user
    os.makedirs(study_area, exist_ok=True)
    print(f"{study_area} created or already existed.")
    ndwi_output = path+r"\NDWI_reclass_output" # Output folder for all reclassed rasters showing water body\n",
    os.makedirs(ndwi_output, exist_ok=True)
    print(f"{ndwi_output} created or already existed.")
    return path, landsats, study_area, ndwi_output

def determineSatellite(filename):
    '''
    Determines the files to assign to each band of the NDWI calculation based on the Landsat satellite the images are taken from by using a dictionary.
    INPUT: string argument of the file name
    USAGE:
    >>determineSatellite("LC09_L2SP_174077_20230521_20230523_02_T1_SR_B5")
    '''
    for sat in BandMap:
        if filename.startswith(sat):
            return sat

def calcNDWI(scene):
    '''
    Computes the NDWI index given the required band files.
    INPUT: dictionary with NIR/Green bands as keys and filenames as values
    USAGE:
    >>calcNDWI({'NIR':'LC09_L2SP_174077_20230521_20230523_02_T1_SR_B5', 'Green': 'LC09_L2SP_174077_20230521_20230523_02_T1_SR_B3' })
    '''
    nir = Raster(scene["NIR"])
    green = Raster(scene["Green"])
    index = (green - nir) / (green + nir)
    return index

def calcArea(counts):
    '''
    Calculates the area of the lakes in both meters squared and acres and appends them into respective lists.
    INPUT: list containing pixel counts for each image
    USAGE:
    >>calcArea([387389, 3289382, 2323, 32334])
    '''

    acres = []
    meters_sq = []
    
    for item in counts:
        new = item*900 # M^2 conversion factor
        meters_sq.append(new)

    for item in meters_sq:
        new = item/4047 # M^2 conversion to acres conversion factor
        acres.append(new)

    return meters_sq, acres
    print("Square meters and acreage calculated and added to lists")

def makeGraph(water_body, years, counts, meters_sq, acres, dates):
    '''
    Makes a graph using given title showing change over time of water body surface area in acres or meters squared.
    INPUT: water body name (string), years (list), pixel counts (list), square meters (list), acres (list)
    USAGE:
    >>makeGraph("Amistad Reservoir", [2014, 2020],[2820, 2910],[13900, 12810],[120011,192101],[12012014, 12132020])
    '''
    pandas_list = [years, counts, meters_sq, acres, dates]
    df = pd.DataFrame(pandas_list).transpose()
    df.columns = ["Year", "Count (pixels)", "Square meters (m^2)", "Acres", "Dates"]
    fig, ax = plt.subplots()
    ax.plot(pandas_list[0], pandas_list[3], 'o-', color = "blue")
    ax.grid()
    ax.set(xlabel = "Year", ylabel = "Water Surface Area (acres)", title = f"Surface Area of {water_body}")
    plt.xticks(pandas_list[0])
    outname = water_body.replace(" ","_")
    outfile = path+ "\\" + f"figure_{outname}.png"
    plt.savefig(outfile, dpi = 300)
    print(f"Graph saved to {outfile}")
    plt.show()
    df.to_csv(f'{water_body}_stats.csv')
    print(df)
  </code>
</pre>
  
<p>
<a href="index.html">‚Üê Back to Home</a>
</p>

</body>
</html>
